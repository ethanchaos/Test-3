<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - ConfigHub</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --dark-bg: #0d1117;
    --card-bg: #161b22;
    --text-light: #e6edf3;
    --text-lighter: #f0f6fc;
    --accent-blue: #58a6ff;
    --accent-green: #3fb950;
    --accent-red: #f85149;
    --accent-purple: #b87fff;
    --accent-orange: #ff9b33;
    --border-color: #30363d;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background-color: var(--dark-bg);
    color: var(--text-light);
    line-height: 1.7;
    scroll-behavior: smooth;
    min-height: 100vh;
  }

  /* Header */
  header {
    background-color: rgba(22, 27, 34, 0.95);
    padding: 1rem 5%;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
  }

  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo i {
    color: var(--accent-blue);
    font-size: 2rem;
    transition: transform 0.5s ease;
  }

  .logo:hover i {
    transform: rotate(360deg);
  }

  .logo h1 {
    font-size: 1.8rem;
    background: linear-gradient(to right, var(--accent-blue), var(--accent-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 700;
  }

  /* Hamburger Menu */
  .hamburger-menu {
    display: none;
    flex-direction: column;
    cursor: pointer;
    width: 30px;
    height: 21px;
    justify-content: space-between;
  }

  .hamburger-menu span {
    display: block;
    height: 3px;
    width: 100%;
    background-color: var(--accent-blue);
    border-radius: 2px;
    transition: var(--transition);
  }

  .nav-menu {
    display: flex;
    gap: 1.5rem;
  }

  .nav-menu a {
    color: var(--text-light);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
    padding: 0.5rem 0.8rem;
    border-radius: 6px;
    font-size: 0.95rem;
  }

  .nav-menu a:hover {
    background-color: rgba(88, 166, 255, 0.1);
    color: var(--accent-blue);
  }

  /* Main Content */
  .main-container {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 0 5%;
  }

  /* Section Headers */
  .section-header {
    margin-bottom: 2rem;
    position: relative;
    display: inline-block;
  }

  .section-header h2 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(to right, var(--accent-blue), var(--accent-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .section-header::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 0;
    width: 60px;
    height: 3px;
    background: var(--accent-blue);
  }

  /* Upload Section */
  .upload-section {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 3rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .upload-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.1), transparent);
    transition: left 0.7s ease;
  }

  .upload-section.uploading::before {
    left: 100%;
  }

  .upload-section:hover {
    box-shadow: 0 8px 25px rgba(88, 166, 255, 0.1);
  }

  .upload-area {
    border: 2px dashed var(--border-color);
    border-radius: 10px;
    padding: 3rem 2rem;
    text-align: center;
    transition: var(--transition);
    margin-bottom: 1.5rem;
    position: relative;
    overflow: hidden;
    background: rgba(22, 27, 34, 0.7);
  }

  .upload-area.active {
    border-color: var(--accent-blue);
    background: rgba(88, 166, 255, 0.05);
  }

  .upload-area i {
    font-size: 3rem;
    color: var(--accent-blue);
    margin-bottom: 1rem;
    display: block;
    transition: var(--transition);
  }

  .upload-area.active i {
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  .upload-area h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-lighter);
  }

  .upload-area p {
    color: #8b949e;
    margin-bottom: 1.5rem;
  }

  .file-input {
    display: none;
  }

  .upload-btn {
    background: var(--accent-blue);
    color: var(--dark-bg);
    border: none;
    border-radius: 30px;
    padding: 0.8rem 2rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
    position: relative;
    overflow: hidden;
  }

  .upload-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.7s ease;
  }

  .upload-btn:hover::before {
    left: 100%;
  }

  .upload-btn:hover {
    background: #388bfd;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(88, 166, 255, 0.3);
  }

  .upload-btn:disabled {
    background: #8b949e;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .selected-files {
    margin-top: 1.5rem;
    text-align: left;
  }

  .selected-files h4 {
    margin-bottom: 0.8rem;
    color: var(--text-lighter);
  }

  .file-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    margin-bottom: 0.5rem;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .file-name {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .file-size {
    color: #8b949e;
    font-size: 0.9rem;
  }

  /* Upload Progress */
  .upload-progress {
    display: none;
    margin-top: 1.5rem;
    text-align: center;
  }

  .upload-progress.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .progress-circle {
    width: 80px;
    height: 80px;
    margin: 0 auto 1rem;
    position: relative;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }

  .progress-circle-bg {
    fill: none;
    stroke: var(--border-color);
    stroke-width: 4;
  }

  .progress-circle-fill {
    fill: none;
    stroke: var(--accent-blue);
    stroke-width: 4;
    stroke-dasharray: 226;
    stroke-dashoffset: 226;
    transition: stroke-dashoffset 0.5s ease;
  }

  .progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-light);
  }

  .upload-status {
    margin-top: 1rem;
    font-weight: 500;
    color: var(--text-light);
  }

  /* Files Section */
  .files-section {
    margin-top: 3rem;
  }

  .config-list {
    background: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
  }

  .config-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
    animation: slideIn 0.3s ease;
    gap: 1rem;
  }

  .config-item:last-child {
    border-bottom: none;
  }

  .config-item:hover {
    background-color: rgba(88, 166, 255, 0.05);
    transform: translateX(5px);
  }

  .config-text {
    flex: 1;
    min-width: 0; /* Prevents text overflow */
  }

  .config-text h3 {
    margin: 0 0 4px 0;
    color: var(--text-lighter);
    font-size: 1.05rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .config-text p {
    margin: 0;
    color: #8b949e;
    font-size: 0.9rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-actions {
    display: flex;
    gap: 10px;
    flex-shrink: 0; /* Prevents button from shrinking */
  }

  .delete-btn {
    background: rgba(248, 81, 73, 0.1);
    border: none;
    border-radius: 8px;
    padding: 8px;
    cursor: pointer;
    transition: var(--transition);
    flex-shrink: 0;
  }

  .delete-btn:hover {
    background: var(--accent-red);
    transform: scale(1.1);
  }

  .delete-btn svg {
    width: 20px;
    height: 20px;
    fill: var(--accent-red);
    transition: var(--transition);
  }

  .delete-btn:hover svg {
    fill: var(--dark-bg);
  }

  /* Empty State */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 4rem 2rem;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
  }

  .empty-state i {
    font-size: 4rem;
    color: var(--accent-blue);
    margin-bottom: 1.5rem;
  }

  .empty-state h3 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    color: var(--text-lighter);
  }

  .empty-state p {
    color: #8b949e;
    max-width: 500px;
    line-height: 1.6;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(13, 17, 23, 0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--border-color);
    text-align: center;
    animation: modalAppear 0.3s ease;
  }

  @keyframes modalAppear {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-icon {
    font-size: 3rem;
    color: var(--accent-red);
    margin-bottom: 1rem;
  }

  .modal h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: var(--text-lighter);
  }

  .modal p {
    color: #8b949e;
    margin-bottom: 2rem;
  }

  .modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .modal-btn {
    padding: 0.7rem 1.5rem;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    flex: 1;
  }

  .modal-btn.cancel {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-light);
  }

  .modal-btn.cancel:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .modal-btn.delete {
    background: var(--accent-red);
    color: white;
  }

  .modal-btn.delete:hover {
    background: #d6423a;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .header-container {
      flex-direction: row;
    }
    
    .hamburger-menu {
      display: flex;
    }
    
    .nav-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      flex-direction: column;
      width: 180px;
      padding: 0.8rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      display: none;
      z-index: 101;
      gap: 0.5rem;
    }
    
    .nav-menu.active {
      display: flex;
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .nav-menu a {
      padding: 0.6rem 0.8rem;
      font-size: 0.9rem;
    }
    
    .upload-area {
      padding: 2rem 1rem;
    }
    
    .config-item {
      flex-direction: row;
      align-items: center;
      gap: 0.8rem;
      padding: 14px 16px;
    }
    
    .file-actions {
      width: auto;
      justify-content: flex-end;
    }
  }

  @media (max-width: 480px) {
    .header-container {
      padding: 0.8rem 5%;
    }
    
    .logo h1 {
      font-size: 1.5rem;
    }
    
    .main-container {
      padding: 0 3%;
      margin: 1.5rem auto;
    }
    
    .upload-section {
      padding: 1.5rem;
    }
    
    .section-header h2 {
      font-size: 1.6rem;
    }
    
    .upload-area h3 {
      font-size: 1.3rem;
    }
    
    .upload-btn {
      padding: 0.7rem 1.5rem;
      font-size: 0.9rem;
    }
    
    .modal-content {
      padding: 1.5rem;
    }
    
    .modal-actions {
      flex-direction: row;
    }
    
    .modal-btn {
      padding: 0.6rem 1.2rem;
      font-size: 0.9rem;
    }
    
    .config-item {
      padding: 12px 14px;
    }
    
    .config-text h3 {
      font-size: 1rem;
    }
    
    .config-text p {
      font-size: 0.85rem;
    }
  }
</style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <div class="logo">
        <i class="fas fa-shield-alt"></i>
        <h1>ConfigHub Admin</h1>
      </div>
      
      <div class="hamburger-menu" id="hamburgerMenu">
        <span></span>
        <span></span>
        <span></span>
      </div>
      
      <nav class="nav-menu" id="navMenu">
        <a href="#"><i class="fas fa-home"></i> Dashboard</a>
        <a href="#"><i class="fas fa-cog"></i> Settings</a>
        <a href="#"><i class="fas fa-question-circle"></i> Help</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-container">
    <!-- Upload Section -->
    <section class="upload-section" id="uploadSection">
      <div class="section-header">
        <h2>Upload Files</h2>
      </div>
      
      <div class="upload-area" id="uploadArea">
        <i class="fas fa-cloud-upload-alt"></i>
        <h3>Drag & Drop Files Here</h3>
        <p>or click to browse your files</p>
        <input type="file" id="fileInput" class="file-input" multiple>
        <button class="upload-btn" id="browseBtn">
          <i class="fas fa-folder-open"></i>
          Browse Files
        </button>
      </div>
      
      <div class="selected-files" id="selectedFiles">
        <!-- Selected files will appear here -->
      </div>
      
      <div class="upload-progress" id="uploadProgress">
        <div class="progress-circle">
          <svg viewBox="0 0 100 100">
            <circle class="progress-circle-bg" cx="50" cy="50" r="45"></circle>
            <circle class="progress-circle-fill" cx="50" cy="50" r="45"></circle>
          </svg>
          <div class="progress-text">0%</div>
        </div>
        <div class="upload-status" id="uploadStatus">Uploading files...</div>
      </div>
      
      <button class="upload-btn" id="uploadBtn" disabled>
        <i class="fas fa-upload"></i>
        Upload Files
      </button>
    </section>
    
    <!-- Files Section -->
    <section class="files-section">
      <div class="section-header">
        <h2>Uploaded Files</h2>
      </div>
      
      <div class="empty-state" id="emptyState">
        <i class="fas fa-folder-open"></i>
        <h3>No files uploaded yet</h3>
        <p>Upload your first file to get started</p>
      </div>
      
      <section class="config-list" id="fileList">
        <!-- Files will be dynamically loaded here -->
      </section>
    </section>
  </main>
  
  <!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <div class="modal-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>Delete File</h3>
      <p id="deleteModalText">Are you sure you want to delete this file? This action cannot be undone.</p>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelDelete">Cancel</button>
        <button class="modal-btn delete" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>

<script>
const GITHUB_USERNAME = "ethanchaos";
const REPO_NAME = "Test-3";
const FOLDER_PATH = "uploads";
const TOKEN = "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";

// DOM Elements
const fileInput = document.getElementById("fileInput");
const browseBtn = document.getElementById("browseBtn");
const uploadArea = document.getElementById("uploadArea");
const uploadBtn = document.getElementById("uploadBtn");
const uploadProgress = document.getElementById("uploadProgress");
const uploadSection = document.getElementById("uploadSection");
const progressFill = document.querySelector(".progress-circle-fill");
const progressText = document.querySelector(".progress-text");
const uploadStatus = document.getElementById("uploadStatus");
const selectedFiles = document.getElementById("selectedFiles");
const fileList = document.getElementById("fileList");
const emptyState = document.getElementById("emptyState");
const deleteModal = document.getElementById("deleteModal");
const deleteModalText = document.getElementById("deleteModalText");
const cancelDelete = document.getElementById("cancelDelete");
const confirmDelete = document.getElementById("confirmDelete");
const hamburgerMenu = document.getElementById("hamburgerMenu");
const navMenu = document.getElementById("navMenu");

// State
let filesToUpload = [];
let fileToDelete = null;

// Event Listeners
browseBtn.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", handleFileSelect);
uploadBtn.addEventListener("click", handleUpload);
cancelDelete.addEventListener("click", () => deleteModal.classList.remove("active"));
confirmDelete.addEventListener("click", performDelete);
hamburgerMenu.addEventListener("click", toggleNavMenu);

// Close nav menu when clicking outside
document.addEventListener("click", (e) => {
  if (!hamburgerMenu.contains(e.target) && !navMenu.contains(e.target)) {
    navMenu.classList.remove("active");
  }
});

// Drag and Drop
uploadArea.addEventListener("dragover", (e) => {
  e.preventDefault();
  uploadArea.classList.add("active");
});

uploadArea.addEventListener("dragleave", () => {
  uploadArea.classList.remove("active");
});

uploadArea.addEventListener("drop", (e) => {
  e.preventDefault();
  uploadArea.classList.remove("active");
  
  if (e.dataTransfer.files.length) {
    fileInput.files = e.dataTransfer.files;
    handleFileSelect();
  }
});

// Toggle navigation menu
function toggleNavMenu() {
  navMenu.classList.toggle("active");
}

// File selection handler
function handleFileSelect() {
  filesToUpload = Array.from(fileInput.files);
  
  if (filesToUpload.length === 0) return;
  
  selectedFiles.innerHTML = `
    <h4>Selected Files (${filesToUpload.length})</h4>
  `;
  
  filesToUpload.forEach(file => {
    const fileItem = document.createElement("div");
    fileItem.className = "file-item";
    fileItem.innerHTML = `
      <div class="file-name">
        <i class="fas fa-file"></i>
        <span>${file.name}</span>
      </div>
      <div class="file-size">${formatFileSize(file.size)}</div>
    `;
    selectedFiles.appendChild(fileItem);
  });
  
  uploadBtn.disabled = false;
}

// Format file size
function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Upload handler
async function handleUpload() {
  if (filesToUpload.length === 0) return;
  
  uploadBtn.disabled = true;
  uploadSection.classList.add("uploading");
  uploadArea.classList.add("active");
  uploadProgress.classList.add("active");
  
  let uploadedCount = 0;
  
  for (let i = 0; i < filesToUpload.length; i++) {
    const file = filesToUpload[i];
    let path = `${FOLDER_PATH}/${file.name}`;
    
    // Update progress
    const progress = ((i + 1) / filesToUpload.length) * 100;
    updateProgress(progress);
    uploadStatus.textContent = `Uploading ${file.name}...`;
    
    // Check if file exists
    const check = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${path}`, {
      headers: { Authorization: `token ${TOKEN}` }
    });
    
    if (check.status === 200) {
      const rename = prompt(`⚠️ File "${file.name}" already exists. Enter a new name or cancel:`, file.name);
      if (!rename) continue;
      path = `${FOLDER_PATH}/${rename}`;
    }
    
    // Upload file
    const content = await readFileAsBase64(file);
    
    const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${path}`, {
      method: "PUT",
      headers: { Authorization: `token ${TOKEN}`, "Content-Type": "application/json" },
      body: JSON.stringify({ 
        message: `Upload ${file.name}`, 
        content 
      })
    });
    
    if (res.ok) {
      uploadedCount++;
      // Update uploads.json
      const url = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/${path}`;
      await updateUploadsJSON({ 
        name: file.name, 
        url, 
        size: formatFileSize(file.size), 
        type: file.type || "other", 
        date: new Date().toISOString().split("T")[0] 
      });
    }
  }
  
  // Reset UI
  uploadStatus.textContent = `✅ Uploaded ${uploadedCount} of ${filesToUpload.length} files`;
  setTimeout(() => {
    uploadSection.classList.remove("uploading");
    uploadArea.classList.remove("active");
    uploadProgress.classList.remove("active");
    uploadBtn.disabled = false;
    selectedFiles.innerHTML = "";
    filesToUpload = [];
    fileInput.value = "";
    fetchFiles();
  }, 2000);
}

// Update progress circle
function updateProgress(percent) {
  const circumference = 2 * Math.PI * 45;
  const offset = circumference - (percent / 100) * circumference;
  progressFill.style.strokeDashoffset = offset;
  progressText.textContent = `${Math.round(percent)}%`;
}

// Read file as base64
function readFileAsBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result.split(',')[1];
      resolve(base64);
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// Fetch files from GitHub
async function fetchFiles() {
  try {
    const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FOLDER_PATH}`, {
      headers: { Authorization: `token ${TOKEN}` }
    });
    
    if (!res.ok) {
      throw new Error("Failed to fetch files");
    }
    
    const files = await res.json();
    
    if (files.length === 0) {
      emptyState.style.display = "flex";
      fileList.style.display = "none";
      return;
    }
    
    emptyState.style.display = "none";
    fileList.style.display = "block";
    fileList.innerHTML = "";
    
    files.forEach(file => {
      const configItem = document.createElement("div");
      configItem.className = "config-item";
      configItem.innerHTML = `
        <div class="config-text">
          <h3>${file.name}</h3>
          <p>Size: ${formatFileSize(file.size)} • Type: ${getFileType(file.name)}</p>
        </div>
        <div class="file-actions">
          <button class="delete-btn" data-path="${file.path}" data-sha="${file.sha}" data-name="${file.name}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
          </button>
        </div>
      `;
      fileList.appendChild(configItem);
    });
    
    // Add event listeners to delete buttons
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const path = btn.getAttribute('data-path');
        const sha = btn.getAttribute('data-sha');
        const name = btn.getAttribute('data-name');
        showDeleteModal(path, sha, name);
      });
    });
  } catch (error) {
    console.error("Error fetching files:", error);
    emptyState.style.display = "flex";
    fileList.style.display = "none";
  }
}

// Get file type from extension
function getFileType(filename) {
  const ext = filename.split('.').pop().toLowerCase();
  const types = {
    'png': 'Image',
    'jpg': 'Image',
    'jpeg': 'Image',
    'gif': 'Image',
    'mp3': 'Audio',
    'wav': 'Audio',
    'mp4': 'Video',
    'avi': 'Video',
    'pdf': 'PDF',
    'doc': 'Document',
    'docx': 'Document',
    'txt': 'Text',
    'zip': 'Archive',
    'rar': 'Archive',
    'hc': 'HTTP Custom',
    'hat': 'HA Tunnel',
    'xt': 'X Tunnel',
    'ar': 'AR Tunnel'
  };
  return types[ext] || 'File';
}

// Show delete confirmation modal
function showDeleteModal(path, sha, name) {
  fileToDelete = { path, sha, name };
  deleteModalText.textContent = `Are you sure you want to delete "${name}"? This action cannot be undone.`;
  deleteModal.classList.add("active");
}

// Perform delete operation
async function performDelete() {
  if (!fileToDelete) return;
  
  const { path, sha, name } = fileToDelete;
  
  try {
    await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${path}`, {
      method: "DELETE",
      headers: { Authorization: `token ${TOKEN}`, "Content-Type": "application/json" },
      body: JSON.stringify({ message: `Deleting ${path}`, sha })
    });
    
    // Update uploads.json
    await updateUploadsJSON(name, true);
    
    deleteModal.classList.remove("active");
    fetchFiles();
  } catch (error) {
    console.error("Error deleting file:", error);
    alert("Failed to delete file. Please try again.");
  }
}

// Update uploads.json
async function updateUploadsJSON(newEntryOrName, isDelete = false) {
  const jsonPath = "uploads.json";
  const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${jsonPath}`;

  let current = [];
  let sha = null;

  const res = await fetch(apiUrl, { headers: { Authorization: `token ${TOKEN}` } });
  if (res.status === 200) {
    const data = await res.json();
    current = JSON.parse(atob(data.content));
    sha = data.sha;
  }

  if (isDelete) {
    current = current.filter(item => item.name !== newEntryOrName);
  } else {
    current.push(newEntryOrName);
  }

  const updated = btoa(unescape(encodeURIComponent(JSON.stringify(current, null, 2))));

  await fetch(apiUrl, {
    method: "PUT",
    headers: { Authorization: `token ${TOKEN}`, "Content-Type": "application/json" },
    body: JSON.stringify({ message: isDelete ? "Delete file" : "Update uploads.json", content: updated, sha })
  });
}

// Initialize
fetchFiles();
</script>
</body>
</html>